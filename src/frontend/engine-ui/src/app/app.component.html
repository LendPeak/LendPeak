<div class="p-grid p-justify-center p-mt-4">
  <div class="p-col-12 p-md-10">
    <div class="card">
      <h2 class="p-text-center p-mb-4">Loan Parameters</h2>

      <!-- Loan Parameters Form -->
      <form class="p-fluid">
        <div class="p-grid">
          <!-- Principal, Interest Rate, Term on one line -->
          <div class="p-col-12">
            <div class="p-grid">
              <div class="p-col-12 p-md-4">
                <div class="p-field">
                  <label for="principal">Principal Amount</label>
                  <input
                    id="principal"
                    type="number"
                    pInputText
                    [(ngModel)]="loan.principal"
                    name="principal"
                    placeholder="Enter principal amount"
                  />
                </div>
              </div>
              <div class="p-col-12 p-md-4">
                <div class="p-field">
                  <label for="interestRate">Interest Rate (%)</label>
                  <input
                    id="interestRate"
                    type="number"
                    pInputText
                    [(ngModel)]="loan.interestRate"
                    name="interestRate"
                    placeholder="Enter interest rate"
                  />
                </div>
              </div>
              <div class="p-col-12 p-md-4">
                <div class="p-field">
                  <label for="term">Term (Months)</label>
                  <input
                    id="term"
                    type="number"
                    pInputText
                    [(ngModel)]="loan.term"
                    name="term"
                    placeholder="Enter loan term in months"
                  />
                </div>
              </div>
            </div>
          </div>

          <!-- Start Date and Calendar Type on another line -->
          <div class="p-col-12">
            <div class="p-grid">
              <div class="p-col-12 p-md-6">
                <div class="p-field">
                  <label for="startDate">Start Date</label>
                  <p-calendar
                    [(ngModel)]="loan.startDate"
                    name="startDate"
                    dateFormat="mm/dd/yy"
                    showIcon
                  ></p-calendar>
                </div>
              </div>
              <div class="p-col-12 p-md-6">
                <div class="p-field">
                  <label for="calendarType">Calendar Type</label>
                  <p-dropdown
                    [(ngModel)]="loan.calendarType"
                    name="calendarType"
                    [options]="calendarTypes"
                    placeholder="Select a calendar type"
                  ></p-dropdown>
                </div>
              </div>
            </div>
          </div>

          <!-- Toggle Button for Advanced Options -->
          <div class="p-col-12 p-text-center p-mt-3">
            <p-button
              label="Toggle Advanced Options"
              icon="pi pi-cog"
              (onClick)="toggleAdvancedOptions()"
            ></p-button>
          </div>

          <!-- Advanced Options Section -->
          <div class="p-col-12" *ngIf="showAdvancedOptions">
            <div class="card">
              <h3 class="p-mb-3">Advanced Options</h3>
              <div class="p-grid">
                <div class="p-col-12 p-md-4">
                  <div class="p-field">
                    <label for="roundingMethod">Rounding Method</label>
                    <p-dropdown
                      [(ngModel)]="loan.roundingMethod"
                      name="roundingMethod"
                      [options]="roundingMethods"
                      placeholder="Select a rounding method"
                    ></p-dropdown>
                  </div>
                </div>
                <div class="p-col-12 p-md-4">
                  <div class="p-field">
                    <label for="flushMethod"
                      >Flush Unbilled Interest Method</label
                    >
                    <p-dropdown
                      [(ngModel)]="loan.flushMethod"
                      name="flushMethod"
                      [options]="flushMethods"
                      placeholder="Select a flush method"
                    ></p-dropdown>
                  </div>
                </div>
                <div class="p-col-12 p-md-4">
                  <div class="p-field">
                    <label for="roundingPrecision">Rounding Precision</label>
                    <input
                      id="roundingPrecision"
                      type="number"
                      pInputText
                      [(ngModel)]="loan.roundingPrecision"
                      name="roundingPrecision"
                      placeholder="Enter rounding precision"
                    />
                  </div>
                </div>
              </div>

              <!-- Flush Threshold (only if flush method is not 'none') -->
              <div class="p-col-12 p-md-6" *ngIf="loan.flushMethod !== 'none'">
                <div class="p-field">
                  <label for="flushThreshold">Flush Threshold</label>
                  <input
                    id="flushThreshold"
                    type="number"
                    pInputText
                    [(ngModel)]="loan.flushThreshold"
                    name="flushThreshold"
                    placeholder="Enter flush threshold"
                  />
                </div>
              </div>
            </div>
          </div>

          <!-- Submit Button -->
          <div class="p-col-12 p-text-center p-mt-3">
            <p-button
              label="Submit"
              icon="pi pi-check"
              (onClick)="submitLoan()"
            ></p-button>
          </div>
        </div>
      </form>

      <!-- Static Table - Visible after Submit -->
      <div *ngIf="showTable" class="p-mt-4">
        <h3 class="p-text-center">Repayment Plan</h3>
        <p-table [value]="repaymentPlan">
          <ng-template pTemplate="header">
            <tr>
              <th>Period</th>
              <th>Period Start Date</th>
              <th>Period End Date</th>
              <th>Interest Rate</th>
              <th>Principal</th>
              <th>Total Interest</th>
              <th>Interest</th>
              <th>Real Interest</th>
              <th>Rounding Error</th>
              <th>Total Payment</th>
              <th>Per Diem</th>
              <th>Days</th>
              <th>Start Balance</th>
              <th>End Balance</th>
              <th>Unbilled Interest</th>
              <th>Metadata</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-plan>
            <tr>
              <td>{{ plan.period }}</td>
              <td>{{ plan.periodStartDate }}</td>
              <td>{{ plan.periodEndDate }}</td>
              <td>{{ plan.periodInterestRate }}</td>
              <td>{{ plan.principal }}</td>
              <td>{{ plan.totalInterestForPeriod }}</td>
              <td>{{ plan.interest }}</td>
              <td>{{ plan.realInterest }}</td>
              <td>{{ plan.interestRoundingError }}</td>
              <td>{{ plan.totalPayment }}</td>
              <td>{{ plan.perDiem }}</td>
              <td>{{ plan.daysInPeriod }}</td>
              <td>{{ plan.startBalance }}</td>
              <td>{{ plan.endBalance }}</td>
              <td>{{ plan.unbilledInterestDueToRounding }}</td>
              <td>{{ plan.metadata }}</td>
            </tr>
          </ng-template>
        </p-table>
      </div>
    </div>
  </div>
</div>
