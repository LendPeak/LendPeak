import dayjs from "dayjs";
import { describe, test, expect } from "@jest/globals";
import { LocalDate, ZoneId } from "@js-joda/core";

import { Currency, RoundingMethod } from "@utils/Currency";
import { DateUtil } from "../../utils/DateUtil";
import { Amortization, AmortizationParams, FlushUnbilledInterestDueToRoundingErrorType } from "@models/Amortization";
import { ChangePaymentDate } from "@models/ChangePaymentDate";
import { ChangePaymentDates } from "@models/ChangePaymentDates";
import { Calendar, CalendarType } from "@models/Calendar";
import { TermCalendars } from "@models/TermCalendars";
import { TermCalendar } from "@models/TermCalendar";
import Decimal from "decimal.js";
import { RateSchedule, RateScheduleParams } from "../../models/RateSchedule";
import { RateSchedules } from "../../models/RateSchedules";
import { LendPeak } from "../../models/LendPeak";
import { Fee } from "../../models/Fee";
import { Bill } from "../../models/Bill";
import { Bills } from "../../models/Bills";
import { DepositRecord } from "../../models/DepositRecord";
import { DepositRecords } from "../../models/DepositRecords";

import utc from "dayjs/plugin/utc";
dayjs.extend(utc);

const today = DateUtil.normalizeDate(LocalDate.now());

describe("Functional Test - Early Payoff - one payment", () => {
  const lendPeak = new LendPeak({
    amortization: new Amortization({
      loanAmount: Currency.of(19_500),
      originationFee: Currency.of(500),
      annualInterestRate: new Decimal(0.0851),
      term: 36,
      startDate: DateUtil.normalizeDate("2022-06-13"),
      firstPaymentDate: DateUtil.normalizeDate("2022-07-14"),
      hasCustomFirstPaymentDate: true,
      defaultPreBillDaysConfiguration: 28,
      calendars: new TermCalendars({
        primary: new Calendar(CalendarType.THIRTY_360),
      }),
    }),
    depositRecords: new DepositRecords([
      new DepositRecord({
        amount: Currency.of(631.44),
        effectiveDate: DateUtil.normalizeDate("2022-07-15"),
        applyExcessToPrincipal: true,
        applyExcessAtTheEndOfThePeriod: true,
        currency: "USD",
      }),
      new DepositRecord({
        amount: Currency.of(631.44),
        applyExcessToPrincipal: true,
        applyExcessAtTheEndOfThePeriod: true,
        effectiveDate: DateUtil.normalizeDate("2022-08-15"),
        currency: "USD",
      }),
      new DepositRecord({
        amount: Currency.of(19_521),
        applyExcessToPrincipal: true,
        applyExcessAtTheEndOfThePeriod: true,
        effectiveDate: DateUtil.normalizeDate("2022-09-12"),
        currency: "USD",
      }),
      // new DepositRecord({
      //   amount: Currency.of(19_121),
      //   applyExcessToPrincipal: true,
      //   applyExcessAtTheEndOfThePeriod: true,
      //   effectiveDate: DateUtil.normalizeDate("2022-09-12"),
      //   currency: "USD",
      // }),
      // new DepositRecord({
      //   amount: Currency.of(161.87),
      //   applyExcessToPrincipal: true,
      //   applyExcessAtTheEndOfThePeriod: true,
      //   effectiveDate: DateUtil.normalizeDate("2022-09-14"),
      //   currency: "USD",
      // }),
    ]),
    currentDate: DateUtil.normalizeDate("2022-11-01"),
  });

  // Force generation of schedule/bills, etc.
  lendPeak.calc();

  it("payoff amount must be zero", () => {
    expect(lendPeak.payoffQuote.dueTotal.toNumber()).toEqual(0);
  });

  // it("verify balance modification", () => {
  //   expect(lendPeak.amortization.balanceModifications.length).toEqual(1);
  //   expect(lendPeak.amortization.balanceModifications.firstModification?.isSystemModification).toEqual(true);
  // });
  it("verify bills", () => {
    // we should have 3 bills
    expect(lendPeak.bills.length).toBe(3);
    const firstBill = lendPeak.bills.atIndex(0);
    expect(firstBill.dueDate.isEqual(DateUtil.normalizeDate("2022-07-14"))).toBe(true);
    expect(firstBill.totalDue).toBeDefined();
  });
});

describe("Functional Test - Early Payoff - two payment", () => {
  const lendPeak = new LendPeak({
    amortization: new Amortization({
      loanAmount: Currency.of(19_500),
      originationFee: Currency.of(500),
      annualInterestRate: new Decimal(0.0851),
      term: 36,
      startDate: DateUtil.normalizeDate("2022-06-13"),
      firstPaymentDate: DateUtil.normalizeDate("2022-07-14"),
      hasCustomFirstPaymentDate: true,
      defaultPreBillDaysConfiguration: 28,
      calendars: new TermCalendars({
        primary: new Calendar(CalendarType.THIRTY_360),
      }),
    }),
    depositRecords: new DepositRecords([
      new DepositRecord({
        amount: Currency.of(631.44),
        effectiveDate: DateUtil.normalizeDate("2022-07-15"),
        applyExcessToPrincipal: true,
        applyExcessAtTheEndOfThePeriod: true,
        currency: "USD",
      }),
      new DepositRecord({
        amount: Currency.of(631.44),
        applyExcessToPrincipal: true,
        applyExcessAtTheEndOfThePeriod: true,
        effectiveDate: DateUtil.normalizeDate("2022-08-15"),
        currency: "USD",
      }),

      new DepositRecord({
        amount: Currency.of(19_121),
        applyExcessToPrincipal: true,
        applyExcessAtTheEndOfThePeriod: true,
        effectiveDate: DateUtil.normalizeDate("2022-09-12"),
        currency: "USD",
      }),
      new DepositRecord({
        amount: Currency.of(161.87),
        applyExcessToPrincipal: true,
        applyExcessAtTheEndOfThePeriod: true,
        effectiveDate: DateUtil.normalizeDate("2022-09-14"),
        currency: "USD",
      }),
    ]),
    currentDate: DateUtil.normalizeDate("2022-11-01"),
  });

  // Force generation of schedule/bills, etc.
  lendPeak.calc();

  it("payoff amount must be zero", () => {
    expect(lendPeak.payoffQuote.dueTotal.toNumber()).toEqual(0);
  });

  // it("verify balance modification", () => {
  //   expect(lendPeak.amortization.balanceModifications.length).toEqual(2);
  //   expect(lendPeak.amortization.balanceModifications.all[0]?.isSystemModification).toEqual(true);
  //   expect(lendPeak.amortization.balanceModifications.all[1]?.isSystemModification).toEqual(true);
  // });
  it("verify bills", () => {
    // we should have 3 bills
    expect(lendPeak.bills.length).toBe(3);
    const firstBill = lendPeak.bills.atIndex(0);
    expect(firstBill.dueDate.isEqual(DateUtil.normalizeDate("2022-07-14"))).toBe(true);
    expect(firstBill.totalDue).toBeDefined();
  });
});

describe("Functional Test - Early Payoff - one period partial", () => {
  const lendPeak = new LendPeak({
    amortization: new Amortization({
      loanAmount: Currency.of(9700),
      originationFee: Currency.of(300),
      annualInterestRate: new Decimal(0.2074),
      term: 36,
      startDate: DateUtil.normalizeDate("2021-10-18"),
      hasCustomEndDate: true,
      endDate: DateUtil.normalizeDate("2024-10-18"),
      defaultPreBillDaysConfiguration: 28,
      accrueInterestAfterEndDate: false,
      calendars: new TermCalendars({
        primary: new Calendar(CalendarType.THIRTY_360_US),
      }),
    }),
    /*
ID,Amount,Currency,Effective Date,Clearing Date,Unused Amount,Apply Excess To Principal,Excess Applied Date,Active
(4352916) [LPT-003392949] Deposit on 2021-11-18,375.42,USD,2021-11-18,2021-11-18,0,Yes,2021-11-18,Yes
(4352917) [LPT-003529119] Deposit on 2021-12-20,375.42,USD,2021-12-20,2021-12-20,0,Yes,2021-12-20,Yes
(4352918) [LPT-003655152] Deposit on 2022-01-18,375.42,USD,2022-01-18,2022-01-18,0,Yes,2022-01-18,Yes
(4352919) [LPT-003792377] Deposit on 2022-02-18,375.42,USD,2022-02-18,2022-02-18,0,Yes,2022-02-18,Yes
(4352920) [LPT-003928301] Deposit on 2022-03-18,375.42,USD,2022-03-18,2022-03-18,0,Yes,2022-03-18,Yes
(4352921) [LPT-004058776] Deposit on 2022-04-18,375.42,USD,2022-04-18,2022-04-18,0,Yes,2022-04-18,Yes
(4352922) [LPT-004200856] Deposit on 2022-05-18,375.42,USD,2022-05-18,2022-05-18,0,Yes,2022-05-18,Yes
(4352923) [LPT-004348527] Deposit on 2022-06-21,375.42,USD,2022-06-21,2022-06-21,0,Yes,2022-06-21,Yes
(4352924) [LPT-004477179] Deposit on 2022-07-18,375.42,USD,2022-07-18,2022-07-18,0,Yes,2022-07-18,Yes
(4352925) [LPT-004632696] Deposit on 2022-08-18,375.42,USD,2022-08-18,2022-08-18,0,Yes,2022-08-18,Yes
(4352926) [LPT-004823210] Deposit on 2022-09-19,375.42,USD,2022-09-19,2022-09-19,0,Yes,2022-09-19,Yes
(4352927) [LPT-004982861] Deposit on 2022-10-18,375.42,USD,2022-10-18,2022-10-18,0,Yes,2022-10-18,Yes
(4352928) [LPT-005161853] Deposit on 2022-11-18,375.42,USD,2022-11-18,2022-11-18,0,Yes,2022-11-18,Yes
(4352929) [LPT-005331154] Deposit on 2022-12-19,375.42,USD,2022-12-19,2022-12-19,0,Yes,2022-12-19,Yes
(4352930) [LPT-005493721] Deposit on 2023-01-18,375.42,USD,2023-01-18,2023-01-18,0,Yes,2023-01-18,Yes
(4352931) [LPT-005664887] Deposit on 2023-02-21,375.42,USD,2023-02-21,2023-02-21,0,Yes,2023-02-21,Yes
(4352932) [LPT-005839019] Deposit on 2023-03-20,375.42,USD,2023-03-20,2023-03-20,0,Yes,2023-03-20,Yes
(4352933) [LPT-006147574] Deposit on 2023-05-18,375.42,USD,2023-05-18,2023-05-18,0,Yes,2023-05-18,Yes
(4352934) [LPT-008200243] Deposit on 2024-10-14,750.84,USD,2024-09-19,2024-10-14,0,Yes,2024-09-19,Yes
(4352949) [LPT-008209445] Deposit on 2024-10-18,496.39,USD,2024-10-09,2024-10-18,0,Yes,2024-10-09,Yes
(4352935) [LPT-008200244] Deposit on 2024-10-14,375.42,USD,2024-10-14,2024-10-14,0,Yes,2024-10-14,Yes
(4352936) [LPT-008200245] Deposit on 2024-10-14,375.42,USD,2024-10-14,2024-10-14,0,Yes,2024-10-14,Yes
(4352937) [LPT-008200246] Deposit on 2024-10-14,750.84,USD,2024-10-14,2024-10-14,0,Yes,2024-10-14,Yes
(4352938) [LPT-008200247] Deposit on 2024-10-14,375.42,USD,2024-10-14,2024-10-14,0,Yes,2024-10-14,Yes
(4352939) [LPT-008200248] Deposit on 2024-10-14,375.42,USD,2024-10-14,2024-10-14,0,Yes,2024-10-14,Yes
(4352940) [LPT-008200249] Deposit on 2024-10-14,375.42,USD,2024-10-14,2024-10-14,0,Yes,2024-10-14,Yes
(4352941) [LPT-008200250] Deposit on 2024-10-14,375.42,USD,2024-10-14,2024-10-14,0,Yes,2024-10-14,Yes
(4352942) [LPT-008200251] Deposit on 2024-10-14,375.42,USD,2024-10-14,2024-10-14,0,Yes,2024-10-14,Yes
(4352943) [LPT-008200252] Deposit on 2024-10-14,375.42,USD,2024-10-14,2024-10-14,0,Yes,2024-10-14,Yes
(4352944) [LPT-008200253] Deposit on 2024-10-14,375.42,USD,2024-10-14,2024-10-14,0,Yes,2024-10-14,Yes
(4352945) [LPT-008200254] Deposit on 2024-10-14,375.42,USD,2024-10-14,2024-10-14,0,Yes,2024-10-14,Yes
(4352946) [LPT-008200255] Deposit on 2024-10-14,375.42,USD,2024-10-14,2024-10-14,0,Yes,2024-10-14,Yes
(4352947) [LPT-008200256] Deposit on 2024-10-14,375.42,USD,2024-10-14,2024-10-14,0,Yes,2024-10-14,Yes
(4352948) [LPT-008200257] Deposit on 2024-10-14,256.36,USD,2024-10-14,2024-10-14,0,Yes,2024-10-14,Yes
    */
    depositRecords: new DepositRecords([
      new DepositRecord({
        id: "(4352934) [LPT-008200243] Deposit on 2024-10-14",
        amount: 750.84,
        currency: "USD",
        createdDate: DateUtil.normalizeDate("2025-04-28"),
        effectiveDate: DateUtil.normalizeDate("2024-10-14"),
        clearingDate: DateUtil.normalizeDate("2024-10-14"),
        systemDate: DateUtil.normalizeDateTime("2025-04-28"),
        paymentMethod: undefined,
        depositor: undefined,
        depositLocation: undefined,
        applyExcessToPrincipal: true,
        excessAppliedDate: DateUtil.normalizeDate("2024-10-14"),
        unusedAmount: 0,
        metadata: {},
        active: true,
        staticAllocation: undefined,
        applyExcessAtTheEndOfThePeriod: true,
      }),
      new DepositRecord({
        id: "(4352935) [LPT-008200244] Deposit on 2024-10-14",
        amount: 375.42,
        currency: "USD",
        createdDate: DateUtil.normalizeDate("2025-04-28"),
        effectiveDate: DateUtil.normalizeDate("2024-10-14"),
        clearingDate: DateUtil.normalizeDate("2024-10-14"),
        systemDate: DateUtil.normalizeDateTime("2025-04-28"),
        paymentMethod: undefined,
        depositor: undefined,
        depositLocation: undefined,
        applyExcessToPrincipal: true,
        excessAppliedDate: DateUtil.normalizeDate("2024-10-14"),
        unusedAmount: 0,
        metadata: {},
        active: true,
        staticAllocation: undefined,
        applyExcessAtTheEndOfThePeriod: true,
      }),
      new DepositRecord({
        id: "(4352936) [LPT-008200245] Deposit on 2024-10-14",
        amount: 375.42,
        currency: "USD",
        createdDate: DateUtil.normalizeDate("2025-04-28"),
        effectiveDate: DateUtil.normalizeDate("2024-10-14"),
        clearingDate: DateUtil.normalizeDate("2024-10-14"),
        systemDate: DateUtil.normalizeDateTime("2025-04-28"),
        paymentMethod: undefined,
        depositor: undefined,
        depositLocation: undefined,
        applyExcessToPrincipal: true,
        excessAppliedDate: DateUtil.normalizeDate("2024-10-14"),
        unusedAmount: 0,
        metadata: {},
        active: true,
        staticAllocation: undefined,
        applyExcessAtTheEndOfThePeriod: true,
      }),
      new DepositRecord({
        id: "(4352937) [LPT-008200246] Deposit on 2024-10-14",
        amount: 750.84,
        currency: "USD",
        createdDate: DateUtil.normalizeDate("2025-04-28"),
        effectiveDate: DateUtil.normalizeDate("2024-10-14"),
        clearingDate: DateUtil.normalizeDate("2024-10-14"),
        systemDate: DateUtil.normalizeDateTime("2025-04-28"),
        paymentMethod: undefined,
        depositor: undefined,
        depositLocation: undefined,
        applyExcessToPrincipal: true,
        excessAppliedDate: DateUtil.normalizeDate("2024-10-14"),
        unusedAmount: 0,
        metadata: {},
        active: true,
        staticAllocation: undefined,
        applyExcessAtTheEndOfThePeriod: true,
      }),
      new DepositRecord({
        id: "(4352938) [LPT-008200247] Deposit on 2024-10-14",
        amount: 375.42,
        currency: "USD",
        createdDate: DateUtil.normalizeDate("2025-04-28"),
        effectiveDate: DateUtil.normalizeDate("2024-10-14"),
        clearingDate: DateUtil.normalizeDate("2024-10-14"),
        systemDate: DateUtil.normalizeDateTime("2025-04-28"),
        paymentMethod: undefined,
        depositor: undefined,
        depositLocation: undefined,
        applyExcessToPrincipal: true,
        excessAppliedDate: DateUtil.normalizeDate("2024-10-14"),
        unusedAmount: 0,
        metadata: {},
        active: true,
        staticAllocation: undefined,
        applyExcessAtTheEndOfThePeriod: true,
      }),
      new DepositRecord({
        id: "(4352939) [LPT-008200248] Deposit on 2024-10-14",
        amount: 375.42,
        currency: "USD",
        createdDate: DateUtil.normalizeDate("2025-04-28"),
        effectiveDate: DateUtil.normalizeDate("2024-10-14"),
        clearingDate: DateUtil.normalizeDate("2024-10-14"),
        systemDate: DateUtil.normalizeDateTime("2025-04-28"),
        paymentMethod: undefined,
        depositor: undefined,
        depositLocation: undefined,
        applyExcessToPrincipal: true,
        excessAppliedDate: DateUtil.normalizeDate("2024-10-14"),
        unusedAmount: 0,
        metadata: {},
        active: true,
        staticAllocation: undefined,
        applyExcessAtTheEndOfThePeriod: true,
      }),
      new DepositRecord({
        id: "(4352940) [LPT-008200249] Deposit on 2024-10-14",
        amount: 375.42,
        currency: "USD",
        createdDate: DateUtil.normalizeDate("2025-04-28"),
        effectiveDate: DateUtil.normalizeDate("2024-10-14"),
        clearingDate: DateUtil.normalizeDate("2024-10-14"),
        systemDate: DateUtil.normalizeDateTime("2025-04-28"),
        paymentMethod: undefined,
        depositor: undefined,
        depositLocation: undefined,
        applyExcessToPrincipal: true,
        excessAppliedDate: DateUtil.normalizeDate("2024-10-14"),
        unusedAmount: 0,
        metadata: {},
        active: true,
        staticAllocation: undefined,
        applyExcessAtTheEndOfThePeriod: true,
      }),
      new DepositRecord({
        id: "(4352941) [LPT-008200250] Deposit on 2024-10-14",
        amount: 375.42,
        currency: "USD",
        createdDate: DateUtil.normalizeDate("2025-04-28"),
        effectiveDate: DateUtil.normalizeDate("2024-10-14"),
        clearingDate: DateUtil.normalizeDate("2024-10-14"),
        systemDate: DateUtil.normalizeDateTime("2025-04-28"),
        paymentMethod: undefined,
        depositor: undefined,
        depositLocation: undefined,
        applyExcessToPrincipal: true,
        excessAppliedDate: DateUtil.normalizeDate("2024-10-14"),
        unusedAmount: 0,
        metadata: {},
        active: true,
        staticAllocation: undefined,
        applyExcessAtTheEndOfThePeriod: true,
      }),
      new DepositRecord({
        id: "(4352942) [LPT-008200251] Deposit on 2024-10-14",
        amount: 375.42,
        currency: "USD",
        createdDate: DateUtil.normalizeDate("2025-04-28"),
        effectiveDate: DateUtil.normalizeDate("2024-10-14"),
        clearingDate: DateUtil.normalizeDate("2024-10-14"),
        systemDate: DateUtil.normalizeDateTime("2025-04-28"),
        paymentMethod: undefined,
        depositor: undefined,
        depositLocation: undefined,
        applyExcessToPrincipal: true,
        excessAppliedDate: DateUtil.normalizeDate("2024-10-14"),
        unusedAmount: 0,
        metadata: {},
        active: true,
        staticAllocation: undefined,
        applyExcessAtTheEndOfThePeriod: true,
      }),
      new DepositRecord({
        id: "(4352943) [LPT-008200252] Deposit on 2024-10-14",
        amount: 375.42,
        currency: "USD",
        createdDate: DateUtil.normalizeDate("2025-04-28"),
        effectiveDate: DateUtil.normalizeDate("2024-10-14"),
        clearingDate: DateUtil.normalizeDate("2024-10-14"),
        systemDate: DateUtil.normalizeDateTime("2025-04-28"),
        paymentMethod: undefined,
        depositor: undefined,
        depositLocation: undefined,
        applyExcessToPrincipal: true,
        excessAppliedDate: DateUtil.normalizeDate("2024-10-14"),
        unusedAmount: 0,
        metadata: {},
        active: true,
        staticAllocation: undefined,
        applyExcessAtTheEndOfThePeriod: true,
      }),
      new DepositRecord({
        id: "(4352944) [LPT-008200253] Deposit on 2024-10-14",
        amount: 375.42,
        currency: "USD",
        createdDate: DateUtil.normalizeDate("2025-04-28"),
        effectiveDate: DateUtil.normalizeDate("2024-10-14"),
        clearingDate: DateUtil.normalizeDate("2024-10-14"),
        systemDate: DateUtil.normalizeDateTime("2025-04-28"),
        paymentMethod: undefined,
        depositor: undefined,
        depositLocation: undefined,
        applyExcessToPrincipal: true,
        excessAppliedDate: DateUtil.normalizeDate("2024-10-14"),
        unusedAmount: 0,
        metadata: {},
        active: true,
        staticAllocation: undefined,
        applyExcessAtTheEndOfThePeriod: true,
      }),
      new DepositRecord({
        id: "(4352945) [LPT-008200254] Deposit on 2024-10-14",
        amount: 375.42,
        currency: "USD",
        createdDate: DateUtil.normalizeDate("2025-04-28"),
        effectiveDate: DateUtil.normalizeDate("2024-10-14"),
        clearingDate: DateUtil.normalizeDate("2024-10-14"),
        systemDate: DateUtil.normalizeDateTime("2025-04-28"),
        paymentMethod: undefined,
        depositor: undefined,
        depositLocation: undefined,
        applyExcessToPrincipal: true,
        excessAppliedDate: DateUtil.normalizeDate("2024-10-14"),
        unusedAmount: 0,
        metadata: {},
        active: true,
        staticAllocation: undefined,
        applyExcessAtTheEndOfThePeriod: true,
      }),
      new DepositRecord({
        id: "(4352946) [LPT-008200255] Deposit on 2024-10-14",
        amount: 375.42,
        currency: "USD",
        createdDate: DateUtil.normalizeDate("2025-04-28"),
        effectiveDate: DateUtil.normalizeDate("2024-10-14"),
        clearingDate: DateUtil.normalizeDate("2024-10-14"),
        systemDate: DateUtil.normalizeDateTime("2025-04-28"),
        paymentMethod: undefined,
        depositor: undefined,
        depositLocation: undefined,
        applyExcessToPrincipal: true,
        excessAppliedDate: DateUtil.normalizeDate("2024-10-14"),
        unusedAmount: 0,
        metadata: {},
        active: true,
        staticAllocation: undefined,
        applyExcessAtTheEndOfThePeriod: true,
      }),
      new DepositRecord({
        id: "(4352947) [LPT-008200256] Deposit on 2024-10-14",
        amount: 375.42,
        currency: "USD",
        createdDate: DateUtil.normalizeDate("2025-04-28"),
        effectiveDate: DateUtil.normalizeDate("2024-10-14"),
        clearingDate: DateUtil.normalizeDate("2024-10-14"),
        systemDate: DateUtil.normalizeDateTime("2025-04-28"),
        paymentMethod: undefined,
        depositor: undefined,
        depositLocation: undefined,
        applyExcessToPrincipal: true,
        excessAppliedDate: DateUtil.normalizeDate("2024-10-14"),
        unusedAmount: 148.78,
        metadata: {},
        active: true,
        staticAllocation: undefined,
        applyExcessAtTheEndOfThePeriod: true,
      }),
      new DepositRecord({
        id: "(4352948) [LPT-008200257] Deposit on 2024-10-14",
        amount: 256.36,
        currency: "USD",
        createdDate: DateUtil.normalizeDate("2025-04-28"),
        effectiveDate: DateUtil.normalizeDate("2024-10-14"),
        clearingDate: DateUtil.normalizeDate("2024-10-14"),
        systemDate: DateUtil.normalizeDateTime("2025-04-28"),
        paymentMethod: undefined,
        depositor: undefined,
        depositLocation: undefined,
        applyExcessToPrincipal: true,
        excessAppliedDate: DateUtil.normalizeDate("2024-10-14"),
        unusedAmount: 256.36,
        metadata: {},
        active: true,
        staticAllocation: undefined,
        applyExcessAtTheEndOfThePeriod: true,
      }),
      new DepositRecord({
        id: "(4352949) [LPT-008209445] Deposit on 2024-10-18",
        amount: 900,
        currency: "USD",
        createdDate: DateUtil.normalizeDate("2025-04-28"),
        effectiveDate: DateUtil.normalizeDate("2024-09-19"),
        clearingDate: DateUtil.normalizeDate("2024-10-18"),
        systemDate: DateUtil.normalizeDateTime("2025-04-28"),
        paymentMethod: undefined,
        depositor: undefined,
        depositLocation: undefined,
        applyExcessToPrincipal: true,
        excessAppliedDate: DateUtil.normalizeDate("2024-09-19"),
        unusedAmount: 0,
        metadata: {},
        active: true,
        staticAllocation: undefined,
        applyExcessAtTheEndOfThePeriod: true,
      }),
      new DepositRecord({
        id: "(4352976) [LPT-008122825] Reversed Deposit on 2024-09-18",
        amount: 256.36,
        currency: "USD",
        createdDate: DateUtil.normalizeDate("2025-04-28"),
        effectiveDate: DateUtil.normalizeDate("2024-09-18"),
        clearingDate: DateUtil.normalizeDate("2024-09-18"),
        systemDate: DateUtil.normalizeDateTime("2025-04-28"),
        paymentMethod: undefined,
        depositor: undefined,
        depositLocation: undefined,
        applyExcessToPrincipal: true,
        excessAppliedDate: DateUtil.normalizeDate("2024-09-18"),
        unusedAmount: 256.36,
        metadata: {},
        active: false,
        staticAllocation: undefined,
        applyExcessAtTheEndOfThePeriod: true,
      }),
      new DepositRecord({
        id: "(4352975) [LPT-008028729] Reversed Deposit on 2024-08-19",
        amount: 375.42,
        currency: "USD",
        createdDate: DateUtil.normalizeDate("2025-04-28"),
        effectiveDate: DateUtil.normalizeDate("2024-08-19"),
        clearingDate: DateUtil.normalizeDate("2024-08-19"),
        systemDate: DateUtil.normalizeDateTime("2025-04-28"),
        paymentMethod: undefined,
        depositor: undefined,
        depositLocation: undefined,
        applyExcessToPrincipal: true,
        excessAppliedDate: DateUtil.normalizeDate("2024-08-19"),
        unusedAmount: 375.42,
        metadata: {},
        active: false,
        staticAllocation: undefined,
        applyExcessAtTheEndOfThePeriod: true,
      }),
      new DepositRecord({
        id: "(4352974) [LPT-007935500] Reversed Deposit on 2024-07-18",
        amount: 375.42,
        currency: "USD",
        createdDate: DateUtil.normalizeDate("2025-04-28"),
        effectiveDate: DateUtil.normalizeDate("2024-07-18"),
        clearingDate: DateUtil.normalizeDate("2024-07-18"),
        systemDate: DateUtil.normalizeDateTime("2025-04-28"),
        paymentMethod: undefined,
        depositor: undefined,
        depositLocation: undefined,
        applyExcessToPrincipal: true,
        excessAppliedDate: DateUtil.normalizeDate("2024-07-18"),
        unusedAmount: 375.42,
        metadata: {},
        active: false,
        staticAllocation: undefined,
        applyExcessAtTheEndOfThePeriod: true,
      }),
      new DepositRecord({
        id: "(4352973) [LPT-007889293] Reversed Deposit on 2024-07-05",
        amount: 375.42,
        currency: "USD",
        createdDate: DateUtil.normalizeDate("2025-04-28"),
        effectiveDate: DateUtil.normalizeDate("2024-07-05"),
        clearingDate: DateUtil.normalizeDate("2024-07-05"),
        systemDate: DateUtil.normalizeDateTime("2025-04-28"),
        paymentMethod: undefined,
        depositor: undefined,
        depositLocation: undefined,
        applyExcessToPrincipal: true,
        excessAppliedDate: DateUtil.normalizeDate("2024-07-05"),
        unusedAmount: 375.42,
        metadata: {},
        active: false,
        staticAllocation: undefined,
        applyExcessAtTheEndOfThePeriod: true,
      }),
      new DepositRecord({
        id: "(4352972) [LPT-007835048] Reversed Deposit on 2024-06-18",
        amount: 375.42,
        currency: "USD",
        createdDate: DateUtil.normalizeDate("2025-04-28"),
        effectiveDate: DateUtil.normalizeDate("2024-06-18"),
        clearingDate: DateUtil.normalizeDate("2024-06-18"),
        systemDate: DateUtil.normalizeDateTime("2025-04-28"),
        paymentMethod: undefined,
        depositor: undefined,
        depositLocation: undefined,
        applyExcessToPrincipal: true,
        excessAppliedDate: DateUtil.normalizeDate("2024-06-18"),
        unusedAmount: 375.42,
        metadata: {},
        active: false,
        staticAllocation: undefined,
        applyExcessAtTheEndOfThePeriod: true,
      }),
      new DepositRecord({
        id: "(4352971) [LPT-007790297] Reversed Deposit on 2024-06-06",
        amount: 375.42,
        currency: "USD",
        createdDate: DateUtil.normalizeDate("2025-04-28"),
        effectiveDate: DateUtil.normalizeDate("2024-06-06"),
        clearingDate: DateUtil.normalizeDate("2024-06-06"),
        systemDate: DateUtil.normalizeDateTime("2025-04-28"),
        paymentMethod: undefined,
        depositor: undefined,
        depositLocation: undefined,
        applyExcessToPrincipal: true,
        excessAppliedDate: DateUtil.normalizeDate("2024-06-06"),
        unusedAmount: 375.42,
        metadata: {},
        active: false,
        staticAllocation: undefined,
        applyExcessAtTheEndOfThePeriod: true,
      }),
      new DepositRecord({
        id: "(4352970) [LPT-007731007] Reversed Deposit on 2024-05-20",
        amount: 375.42,
        currency: "USD",
        createdDate: DateUtil.normalizeDate("2025-04-28"),
        effectiveDate: DateUtil.normalizeDate("2024-05-20"),
        clearingDate: DateUtil.normalizeDate("2024-05-20"),
        systemDate: DateUtil.normalizeDateTime("2025-04-28"),
        paymentMethod: undefined,
        depositor: undefined,
        depositLocation: undefined,
        applyExcessToPrincipal: true,
        excessAppliedDate: DateUtil.normalizeDate("2024-05-20"),
        unusedAmount: 375.42,
        metadata: {},
        active: false,
        staticAllocation: undefined,
        applyExcessAtTheEndOfThePeriod: true,
      }),
      new DepositRecord({
        id: "(4352969) [LPT-007620200] Reversed Deposit on 2024-04-18",
        amount: 375.42,
        currency: "USD",
        createdDate: DateUtil.normalizeDate("2025-04-28"),
        effectiveDate: DateUtil.normalizeDate("2024-04-18"),
        clearingDate: DateUtil.normalizeDate("2024-04-18"),
        systemDate: DateUtil.normalizeDateTime("2025-04-28"),
        paymentMethod: undefined,
        depositor: undefined,
        depositLocation: undefined,
        applyExcessToPrincipal: true,
        excessAppliedDate: DateUtil.normalizeDate("2024-04-18"),
        unusedAmount: 375.42,
        metadata: {},
        active: false,
        staticAllocation: undefined,
        applyExcessAtTheEndOfThePeriod: true,
      }),
      new DepositRecord({
        id: "(4352968) [LPT-007547944] Reversed Deposit on 2024-03-29",
        amount: 375.42,
        currency: "USD",
        createdDate: DateUtil.normalizeDate("2025-04-28"),
        effectiveDate: DateUtil.normalizeDate("2024-03-29"),
        clearingDate: DateUtil.normalizeDate("2024-03-29"),
        systemDate: DateUtil.normalizeDateTime("2025-04-28"),
        paymentMethod: undefined,
        depositor: undefined,
        depositLocation: undefined,
        applyExcessToPrincipal: true,
        excessAppliedDate: DateUtil.normalizeDate("2024-03-29"),
        unusedAmount: 375.42,
        metadata: {},
        active: false,
        staticAllocation: undefined,
        applyExcessAtTheEndOfThePeriod: true,
      }),
      new DepositRecord({
        id: "(4352967) [LPT-007498267] Reversed Deposit on 2024-03-18",
        amount: 375.42,
        currency: "USD",
        createdDate: DateUtil.normalizeDate("2025-04-28"),
        effectiveDate: DateUtil.normalizeDate("2024-03-18"),
        clearingDate: DateUtil.normalizeDate("2024-03-18"),
        systemDate: DateUtil.normalizeDateTime("2025-04-28"),
        paymentMethod: undefined,
        depositor: undefined,
        depositLocation: undefined,
        applyExcessToPrincipal: true,
        excessAppliedDate: DateUtil.normalizeDate("2024-03-18"),
        unusedAmount: 375.42,
        metadata: {},
        active: false,
        staticAllocation: undefined,
        applyExcessAtTheEndOfThePeriod: true,
      }),
      new DepositRecord({
        id: "(4352966) [LPT-007385801] Reversed Deposit on 2024-02-20",
        amount: 375.42,
        currency: "USD",
        createdDate: DateUtil.normalizeDate("2025-04-28"),
        effectiveDate: DateUtil.normalizeDate("2024-02-20"),
        clearingDate: DateUtil.normalizeDate("2024-02-20"),
        systemDate: DateUtil.normalizeDateTime("2025-04-28"),
        paymentMethod: undefined,
        depositor: undefined,
        depositLocation: undefined,
        applyExcessToPrincipal: true,
        excessAppliedDate: DateUtil.normalizeDate("2024-02-20"),
        unusedAmount: 375.42,
        metadata: {},
        active: false,
        staticAllocation: undefined,
        applyExcessAtTheEndOfThePeriod: true,
      }),
      new DepositRecord({
        id: "(4352965) [LPT-007263946] Reversed Deposit on 2024-01-18",
        amount: 375.42,
        currency: "USD",
        createdDate: DateUtil.normalizeDate("2025-04-28"),
        effectiveDate: DateUtil.normalizeDate("2024-01-18"),
        clearingDate: DateUtil.normalizeDate("2024-01-18"),
        systemDate: DateUtil.normalizeDateTime("2025-04-28"),
        paymentMethod: undefined,
        depositor: undefined,
        depositLocation: undefined,
        applyExcessToPrincipal: true,
        excessAppliedDate: DateUtil.normalizeDate("2024-01-18"),
        unusedAmount: 375.42,
        metadata: {},
        active: false,
        staticAllocation: undefined,
        applyExcessAtTheEndOfThePeriod: true,
      }),
      new DepositRecord({
        id: "(4352964) [LPT-007135311] Reversed Deposit on 2023-12-18",
        amount: 375.42,
        currency: "USD",
        createdDate: DateUtil.normalizeDate("2025-04-28"),
        effectiveDate: DateUtil.normalizeDate("2023-12-18"),
        clearingDate: DateUtil.normalizeDate("2023-12-18"),
        systemDate: DateUtil.normalizeDateTime("2025-04-28"),
        paymentMethod: undefined,
        depositor: undefined,
        depositLocation: undefined,
        applyExcessToPrincipal: true,
        excessAppliedDate: DateUtil.normalizeDate("2023-12-18"),
        unusedAmount: 375.42,
        metadata: {},
        active: false,
        staticAllocation: undefined,
        applyExcessAtTheEndOfThePeriod: true,
      }),
      new DepositRecord({
        id: "(4352962) [LPT-007034377] Reversed Deposit on 2023-11-24",
        amount: 375.42,
        currency: "USD",
        createdDate: DateUtil.normalizeDate("2025-04-28"),
        effectiveDate: DateUtil.normalizeDate("2023-11-24"),
        clearingDate: DateUtil.normalizeDate("2023-11-24"),
        systemDate: DateUtil.normalizeDateTime("2025-04-28"),
        paymentMethod: undefined,
        depositor: undefined,
        depositLocation: undefined,
        applyExcessToPrincipal: true,
        excessAppliedDate: DateUtil.normalizeDate("2023-11-24"),
        unusedAmount: 375.42,
        metadata: {},
        active: false,
        staticAllocation: undefined,
        applyExcessAtTheEndOfThePeriod: true,
      }),
      new DepositRecord({
        id: "(4352950) [LPT-006974230] Reversed Deposit on 2023-11-10",
        amount: 750.84,
        currency: "USD",
        createdDate: DateUtil.normalizeDate("2025-04-28"),
        effectiveDate: DateUtil.normalizeDate("2023-11-10"),
        clearingDate: DateUtil.normalizeDate("2023-11-10"),
        systemDate: DateUtil.normalizeDateTime("2025-04-28"),
        paymentMethod: undefined,
        depositor: undefined,
        depositLocation: undefined,
        applyExcessToPrincipal: true,
        excessAppliedDate: DateUtil.normalizeDate("2023-11-10"),
        unusedAmount: 750.84,
        metadata: {},
        active: false,
        staticAllocation: undefined,
        applyExcessAtTheEndOfThePeriod: true,
      }),
      new DepositRecord({
        id: "(4352953) [LPT-006878806] Reversed Deposit on 2023-10-18",
        amount: 375.42,
        currency: "USD",
        createdDate: DateUtil.normalizeDate("2025-04-28"),
        effectiveDate: DateUtil.normalizeDate("2023-10-18"),
        clearingDate: DateUtil.normalizeDate("2023-10-18"),
        systemDate: DateUtil.normalizeDateTime("2025-04-28"),
        paymentMethod: undefined,
        depositor: undefined,
        depositLocation: undefined,
        applyExcessToPrincipal: true,
        excessAppliedDate: DateUtil.normalizeDate("2023-10-18"),
        unusedAmount: 375.42,
        metadata: {},
        active: false,
        staticAllocation: undefined,
        applyExcessAtTheEndOfThePeriod: true,
      }),
      new DepositRecord({
        id: "(4352952) [LPT-006727975] Reversed Deposit on 2023-09-18",
        amount: 375.42,
        currency: "USD",
        createdDate: DateUtil.normalizeDate("2025-04-28"),
        effectiveDate: DateUtil.normalizeDate("2023-09-18"),
        clearingDate: DateUtil.normalizeDate("2023-09-18"),
        systemDate: DateUtil.normalizeDateTime("2025-04-28"),
        paymentMethod: undefined,
        depositor: undefined,
        depositLocation: undefined,
        applyExcessToPrincipal: true,
        excessAppliedDate: DateUtil.normalizeDate("2023-09-18"),
        unusedAmount: 375.42,
        metadata: {},
        active: false,
        staticAllocation: undefined,
        applyExcessAtTheEndOfThePeriod: true,
      }),
      new DepositRecord({
        id: "(4352951) [LPT-006592435] Reversed Deposit on 2023-08-18",
        amount: 375.42,
        currency: "USD",
        createdDate: DateUtil.normalizeDate("2025-04-28"),
        effectiveDate: DateUtil.normalizeDate("2023-08-18"),
        clearingDate: DateUtil.normalizeDate("2023-08-18"),
        systemDate: DateUtil.normalizeDateTime("2025-04-28"),
        paymentMethod: undefined,
        depositor: undefined,
        depositLocation: undefined,
        applyExcessToPrincipal: true,
        excessAppliedDate: DateUtil.normalizeDate("2023-08-18"),
        unusedAmount: 375.42,
        metadata: {},
        active: false,
        staticAllocation: undefined,
        applyExcessAtTheEndOfThePeriod: true,
      }),
      new DepositRecord({
        id: "(4352961) [LPT-006479757] Reversed Deposit on 2023-07-25",
        amount: 375.42,
        currency: "USD",
        createdDate: DateUtil.normalizeDate("2025-04-28"),
        effectiveDate: DateUtil.normalizeDate("2023-07-25"),
        clearingDate: DateUtil.normalizeDate("2023-07-25"),
        systemDate: DateUtil.normalizeDateTime("2025-04-28"),
        paymentMethod: undefined,
        depositor: undefined,
        depositLocation: undefined,
        applyExcessToPrincipal: true,
        excessAppliedDate: DateUtil.normalizeDate("2023-07-25"),
        unusedAmount: 375.42,
        metadata: {},
        active: false,
        staticAllocation: undefined,
        applyExcessAtTheEndOfThePeriod: true,
      }),
      new DepositRecord({
        id: "(4352958) [LPT-006445928] Reversed Deposit on 2023-07-18",
        amount: 375.42,
        currency: "USD",
        createdDate: DateUtil.normalizeDate("2025-04-28"),
        effectiveDate: DateUtil.normalizeDate("2023-07-18"),
        clearingDate: DateUtil.normalizeDate("2023-07-18"),
        systemDate: DateUtil.normalizeDateTime("2025-04-28"),
        paymentMethod: undefined,
        depositor: undefined,
        depositLocation: undefined,
        applyExcessToPrincipal: true,
        excessAppliedDate: DateUtil.normalizeDate("2023-07-18"),
        unusedAmount: 375.42,
        metadata: {},
        active: false,
        staticAllocation: undefined,
        applyExcessAtTheEndOfThePeriod: true,
      }),
      new DepositRecord({
        id: "(4352957) [LPT-006343020] Reversed Deposit on 2023-06-26",
        amount: 750.84,
        currency: "USD",
        createdDate: DateUtil.normalizeDate("2025-04-28"),
        effectiveDate: DateUtil.normalizeDate("2023-06-26"),
        clearingDate: DateUtil.normalizeDate("2023-06-26"),
        systemDate: DateUtil.normalizeDateTime("2025-04-28"),
        paymentMethod: undefined,
        depositor: undefined,
        depositLocation: undefined,
        applyExcessToPrincipal: true,
        excessAppliedDate: DateUtil.normalizeDate("2023-06-26"),
        unusedAmount: 750.84,
        metadata: {},
        active: false,
        staticAllocation: undefined,
        applyExcessAtTheEndOfThePeriod: true,
      }),
      new DepositRecord({
        id: "(4352956) [LPT-006308145] Reversed Deposit on 2023-06-20",
        amount: 375.42,
        currency: "USD",
        createdDate: DateUtil.normalizeDate("2025-04-28"),
        effectiveDate: DateUtil.normalizeDate("2023-06-20"),
        clearingDate: DateUtil.normalizeDate("2023-06-20"),
        systemDate: DateUtil.normalizeDateTime("2025-04-28"),
        paymentMethod: undefined,
        depositor: undefined,
        depositLocation: undefined,
        applyExcessToPrincipal: true,
        excessAppliedDate: DateUtil.normalizeDate("2023-06-20"),
        unusedAmount: 375.42,
        metadata: {},
        active: false,
        staticAllocation: undefined,
        applyExcessAtTheEndOfThePeriod: true,
      }),
      new DepositRecord({
        id: "(4352955) [LPT-006250197] Reversed Deposit on 2023-06-09",
        amount: 750.84,
        currency: "USD",
        createdDate: DateUtil.normalizeDate("2025-04-28"),
        effectiveDate: DateUtil.normalizeDate("2023-06-09"),
        clearingDate: DateUtil.normalizeDate("2023-06-09"),
        systemDate: DateUtil.normalizeDateTime("2025-04-28"),
        paymentMethod: undefined,
        depositor: undefined,
        depositLocation: undefined,
        applyExcessToPrincipal: true,
        excessAppliedDate: DateUtil.normalizeDate("2023-06-09"),
        unusedAmount: 750.84,
        metadata: {},
        active: false,
        staticAllocation: undefined,
        applyExcessAtTheEndOfThePeriod: true,
      }),
      new DepositRecord({
        id: "(4352933) [LPT-006147574] Deposit on 2023-05-18",
        amount: 375.42,
        currency: "USD",
        createdDate: DateUtil.normalizeDate("2025-04-28"),
        effectiveDate: DateUtil.normalizeDate("2023-05-18"),
        clearingDate: DateUtil.normalizeDate("2023-05-18"),
        systemDate: DateUtil.normalizeDateTime("2025-04-28"),
        paymentMethod: undefined,
        depositor: undefined,
        depositLocation: undefined,
        applyExcessToPrincipal: true,
        excessAppliedDate: DateUtil.normalizeDate("2023-05-18"),
        unusedAmount: 0,
        metadata: {},
        active: true,
        staticAllocation: undefined,
        applyExcessAtTheEndOfThePeriod: true,
      }),
      new DepositRecord({
        id: "(4352954) [LPT-005990105] Reversed Deposit on 2023-04-18",
        amount: 375.42,
        currency: "USD",
        createdDate: DateUtil.normalizeDate("2025-04-28"),
        effectiveDate: DateUtil.normalizeDate("2023-04-18"),
        clearingDate: DateUtil.normalizeDate("2023-04-18"),
        systemDate: DateUtil.normalizeDateTime("2025-04-28"),
        paymentMethod: undefined,
        depositor: undefined,
        depositLocation: undefined,
        applyExcessToPrincipal: true,
        excessAppliedDate: DateUtil.normalizeDate("2023-04-18"),
        unusedAmount: 375.42,
        metadata: {},
        active: false,
        staticAllocation: undefined,
        applyExcessAtTheEndOfThePeriod: true,
      }),
      new DepositRecord({
        id: "(4352932) [LPT-005839019] Deposit on 2023-03-20",
        amount: 375.42,
        currency: "USD",
        createdDate: DateUtil.normalizeDate("2025-04-28"),
        effectiveDate: DateUtil.normalizeDate("2023-03-20"),
        clearingDate: DateUtil.normalizeDate("2023-03-20"),
        systemDate: DateUtil.normalizeDateTime("2025-04-28"),
        paymentMethod: undefined,
        depositor: undefined,
        depositLocation: undefined,
        applyExcessToPrincipal: true,
        excessAppliedDate: DateUtil.normalizeDate("2023-03-20"),
        unusedAmount: 0,
        metadata: {},
        active: true,
        staticAllocation: undefined,
        applyExcessAtTheEndOfThePeriod: true,
      }),
      new DepositRecord({
        id: "(4352931) [LPT-005664887] Deposit on 2023-02-21",
        amount: 375.42,
        currency: "USD",
        createdDate: DateUtil.normalizeDate("2025-04-28"),
        effectiveDate: DateUtil.normalizeDate("2023-02-21"),
        clearingDate: DateUtil.normalizeDate("2023-02-21"),
        systemDate: DateUtil.normalizeDateTime("2025-04-28"),
        paymentMethod: undefined,
        depositor: undefined,
        depositLocation: undefined,
        applyExcessToPrincipal: true,
        excessAppliedDate: DateUtil.normalizeDate("2023-02-21"),
        unusedAmount: 0,
        metadata: {},
        active: true,
        staticAllocation: undefined,
        applyExcessAtTheEndOfThePeriod: true,
      }),
      new DepositRecord({
        id: "(4352930) [LPT-005493721] Deposit on 2023-01-18",
        amount: 375.42,
        currency: "USD",
        createdDate: DateUtil.normalizeDate("2025-04-28"),
        effectiveDate: DateUtil.normalizeDate("2023-01-18"),
        clearingDate: DateUtil.normalizeDate("2023-01-18"),
        systemDate: DateUtil.normalizeDateTime("2025-04-28"),
        paymentMethod: undefined,
        depositor: undefined,
        depositLocation: undefined,
        applyExcessToPrincipal: true,
        excessAppliedDate: DateUtil.normalizeDate("2023-01-18"),
        unusedAmount: 0,
        metadata: {},
        active: true,
        staticAllocation: undefined,
        applyExcessAtTheEndOfThePeriod: true,
      }),
      new DepositRecord({
        id: "(4352929) [LPT-005331154] Deposit on 2022-12-19",
        amount: 375.42,
        currency: "USD",
        createdDate: DateUtil.normalizeDate("2025-04-28"),
        effectiveDate: DateUtil.normalizeDate("2022-12-19"),
        clearingDate: DateUtil.normalizeDate("2022-12-19"),
        systemDate: DateUtil.normalizeDateTime("2025-04-28"),
        paymentMethod: undefined,
        depositor: undefined,
        depositLocation: undefined,
        applyExcessToPrincipal: true,
        excessAppliedDate: DateUtil.normalizeDate("2022-12-19"),
        unusedAmount: 0,
        metadata: {},
        active: true,
        staticAllocation: undefined,
        applyExcessAtTheEndOfThePeriod: true,
      }),
      new DepositRecord({
        id: "(4352928) [LPT-005161853] Deposit on 2022-11-18",
        amount: 375.42,
        currency: "USD",
        createdDate: DateUtil.normalizeDate("2025-04-28"),
        effectiveDate: DateUtil.normalizeDate("2022-11-18"),
        clearingDate: DateUtil.normalizeDate("2022-11-18"),
        systemDate: DateUtil.normalizeDateTime("2025-04-28"),
        paymentMethod: undefined,
        depositor: undefined,
        depositLocation: undefined,
        applyExcessToPrincipal: true,
        excessAppliedDate: DateUtil.normalizeDate("2022-11-18"),
        unusedAmount: 0,
        metadata: {},
        active: true,
        staticAllocation: undefined,
        applyExcessAtTheEndOfThePeriod: true,
      }),
      new DepositRecord({
        id: "(4352927) [LPT-004982861] Deposit on 2022-10-18",
        amount: 375.42,
        currency: "USD",
        createdDate: DateUtil.normalizeDate("2025-04-28"),
        effectiveDate: DateUtil.normalizeDate("2022-10-18"),
        clearingDate: DateUtil.normalizeDate("2022-10-18"),
        systemDate: DateUtil.normalizeDateTime("2025-04-28"),
        paymentMethod: undefined,
        depositor: undefined,
        depositLocation: undefined,
        applyExcessToPrincipal: true,
        excessAppliedDate: DateUtil.normalizeDate("2022-10-18"),
        unusedAmount: 0,
        metadata: {},
        active: true,
        staticAllocation: undefined,
        applyExcessAtTheEndOfThePeriod: true,
      }),
      new DepositRecord({
        id: "(4352926) [LPT-004823210] Deposit on 2022-09-19",
        amount: 375.42,
        currency: "USD",
        createdDate: DateUtil.normalizeDate("2025-04-28"),
        effectiveDate: DateUtil.normalizeDate("2022-09-19"),
        clearingDate: DateUtil.normalizeDate("2022-09-19"),
        systemDate: DateUtil.normalizeDateTime("2025-04-28"),
        paymentMethod: undefined,
        depositor: undefined,
        depositLocation: undefined,
        applyExcessToPrincipal: true,
        excessAppliedDate: DateUtil.normalizeDate("2022-09-19"),
        unusedAmount: 0,
        metadata: {},
        active: true,
        staticAllocation: undefined,
        applyExcessAtTheEndOfThePeriod: true,
      }),
      new DepositRecord({
        id: "(4352925) [LPT-004632696] Deposit on 2022-08-18",
        amount: 375.42,
        currency: "USD",
        createdDate: DateUtil.normalizeDate("2025-04-28"),
        effectiveDate: DateUtil.normalizeDate("2022-08-18"),
        clearingDate: DateUtil.normalizeDate("2022-08-18"),
        systemDate: DateUtil.normalizeDateTime("2025-04-28"),
        paymentMethod: undefined,
        depositor: undefined,
        depositLocation: undefined,
        applyExcessToPrincipal: true,
        excessAppliedDate: DateUtil.normalizeDate("2022-08-18"),
        unusedAmount: 0,
        metadata: {},
        active: true,
        staticAllocation: undefined,
        applyExcessAtTheEndOfThePeriod: true,
      }),
      new DepositRecord({
        id: "(4352924) [LPT-004477179] Deposit on 2022-07-18",
        amount: 375.42,
        currency: "USD",
        createdDate: DateUtil.normalizeDate("2025-04-28"),
        effectiveDate: DateUtil.normalizeDate("2022-07-18"),
        clearingDate: DateUtil.normalizeDate("2022-07-18"),
        systemDate: DateUtil.normalizeDateTime("2025-04-28"),
        paymentMethod: undefined,
        depositor: undefined,
        depositLocation: undefined,
        applyExcessToPrincipal: true,
        excessAppliedDate: DateUtil.normalizeDate("2022-07-18"),
        unusedAmount: 0,
        metadata: {},
        active: true,
        staticAllocation: undefined,
        applyExcessAtTheEndOfThePeriod: true,
      }),
      new DepositRecord({
        id: "(4352923) [LPT-004348527] Deposit on 2022-06-21",
        amount: 375.42,
        currency: "USD",
        createdDate: DateUtil.normalizeDate("2025-04-28"),
        effectiveDate: DateUtil.normalizeDate("2022-06-21"),
        clearingDate: DateUtil.normalizeDate("2022-06-21"),
        systemDate: DateUtil.normalizeDateTime("2025-04-28"),
        paymentMethod: undefined,
        depositor: undefined,
        depositLocation: undefined,
        applyExcessToPrincipal: true,
        excessAppliedDate: DateUtil.normalizeDate("2022-06-21"),
        unusedAmount: 0,
        metadata: {},
        active: true,
        staticAllocation: undefined,
        applyExcessAtTheEndOfThePeriod: true,
      }),
      new DepositRecord({
        id: "(4352922) [LPT-004200856] Deposit on 2022-05-18",
        amount: 375.42,
        currency: "USD",
        createdDate: DateUtil.normalizeDate("2025-04-28"),
        effectiveDate: DateUtil.normalizeDate("2022-05-18"),
        clearingDate: DateUtil.normalizeDate("2022-05-18"),
        systemDate: DateUtil.normalizeDateTime("2025-04-28"),
        paymentMethod: undefined,
        depositor: undefined,
        depositLocation: undefined,
        applyExcessToPrincipal: true,
        excessAppliedDate: DateUtil.normalizeDate("2022-05-18"),
        unusedAmount: 0,
        metadata: {},
        active: true,
        staticAllocation: undefined,
        applyExcessAtTheEndOfThePeriod: true,
      }),
      new DepositRecord({
        id: "(4352921) [LPT-004058776] Deposit on 2022-04-18",
        amount: 375.42,
        currency: "USD",
        createdDate: DateUtil.normalizeDate("2025-04-28"),
        effectiveDate: DateUtil.normalizeDate("2022-04-18"),
        clearingDate: DateUtil.normalizeDate("2022-04-18"),
        systemDate: DateUtil.normalizeDateTime("2025-04-28"),
        paymentMethod: undefined,
        depositor: undefined,
        depositLocation: undefined,
        applyExcessToPrincipal: true,
        excessAppliedDate: DateUtil.normalizeDate("2022-04-18"),
        unusedAmount: 0,
        metadata: {},
        active: true,
        staticAllocation: undefined,
        applyExcessAtTheEndOfThePeriod: true,
      }),
      new DepositRecord({
        id: "(4352920) [LPT-003928301] Deposit on 2022-03-18",
        amount: 375.42,
        currency: "USD",
        createdDate: DateUtil.normalizeDate("2025-04-28"),
        effectiveDate: DateUtil.normalizeDate("2022-03-18"),
        clearingDate: DateUtil.normalizeDate("2022-03-18"),
        systemDate: DateUtil.normalizeDateTime("2025-04-28"),
        paymentMethod: undefined,
        depositor: undefined,
        depositLocation: undefined,
        applyExcessToPrincipal: true,
        excessAppliedDate: DateUtil.normalizeDate("2022-03-18"),
        unusedAmount: 0,
        metadata: {},
        active: true,
        staticAllocation: undefined,
        applyExcessAtTheEndOfThePeriod: true,
      }),
      new DepositRecord({
        id: "(4352919) [LPT-003792377] Deposit on 2022-02-18",
        amount: 375.42,
        currency: "USD",
        createdDate: DateUtil.normalizeDate("2025-04-28"),
        effectiveDate: DateUtil.normalizeDate("2022-02-18"),
        clearingDate: DateUtil.normalizeDate("2022-02-18"),
        systemDate: DateUtil.normalizeDateTime("2025-04-28"),
        paymentMethod: undefined,
        depositor: undefined,
        depositLocation: undefined,
        applyExcessToPrincipal: true,
        excessAppliedDate: DateUtil.normalizeDate("2022-02-18"),
        unusedAmount: 0,
        metadata: {},
        active: true,
        staticAllocation: undefined,
        applyExcessAtTheEndOfThePeriod: true,
      }),
      new DepositRecord({
        id: "(4352918) [LPT-003655152] Deposit on 2022-01-18",
        amount: 375.42,
        currency: "USD",
        createdDate: DateUtil.normalizeDate("2025-04-28"),
        effectiveDate: DateUtil.normalizeDate("2022-01-18"),
        clearingDate: DateUtil.normalizeDate("2022-01-18"),
        systemDate: DateUtil.normalizeDateTime("2025-04-28"),
        paymentMethod: undefined,
        depositor: undefined,
        depositLocation: undefined,
        applyExcessToPrincipal: true,
        excessAppliedDate: DateUtil.normalizeDate("2022-01-18"),
        unusedAmount: 0,
        metadata: {},
        active: true,
        staticAllocation: undefined,
        applyExcessAtTheEndOfThePeriod: true,
      }),
      new DepositRecord({
        id: "(4352917) [LPT-003529119] Deposit on 2021-12-20",
        amount: 375.42,
        currency: "USD",
        createdDate: DateUtil.normalizeDate("2025-04-28"),
        effectiveDate: DateUtil.normalizeDate("2021-12-20"),
        clearingDate: DateUtil.normalizeDate("2021-12-20"),
        systemDate: DateUtil.normalizeDateTime("2025-04-28"),
        paymentMethod: undefined,
        depositor: undefined,
        depositLocation: undefined,
        applyExcessToPrincipal: true,
        excessAppliedDate: DateUtil.normalizeDate("2021-12-20"),
        unusedAmount: 0,
        metadata: {},
        active: true,
        staticAllocation: undefined,
        applyExcessAtTheEndOfThePeriod: true,
      }),
      new DepositRecord({
        id: "(4352916) [LPT-003392949] Deposit on 2021-11-18",
        amount: 375.42,
        currency: "USD",
        createdDate: DateUtil.normalizeDate("2025-04-28"),
        effectiveDate: DateUtil.normalizeDate("2021-11-18"),
        clearingDate: DateUtil.normalizeDate("2021-11-18"),
        systemDate: DateUtil.normalizeDateTime("2025-04-28"),
        paymentMethod: undefined,
        depositor: undefined,
        depositLocation: undefined,
        applyExcessToPrincipal: true,
        excessAppliedDate: DateUtil.normalizeDate("2021-11-18"),
        unusedAmount: 0,
        metadata: {},
        active: true,
        staticAllocation: undefined,
        applyExcessAtTheEndOfThePeriod: true,
      }),
    ]),
    currentDate: DateUtil.normalizeDate("2025-01-01"),
  });

  // Force generation of schedule/bills, etc.
  lendPeak.calc();

  it("unusedAmountFromDeposis must be zero", () => {
    expect(lendPeak.payoffQuote.unusedAmountFromDeposis.toNumber()).toEqual(405.66);
  });

  it("payoff amount must be zero", () => {
    expect(lendPeak.payoffQuote.dueTotal.toNumber()).toEqual(0);
  });

  it("verify balance modification to be set to zero", () => {
    expect(lendPeak.amortization.balanceModifications.length).toEqual(0);
  });

  it("verify bills", () => {
    expect(lendPeak.bills.length).toBe(36);
  });
});

describe("Functional Test - Early Payoff - multiple payments mid cycle", () => {
  const params: AmortizationParams = {
    id: "LAI-00663434",
    name: "PA0C5F580C37F",
    description: "Imported from CLS (LAI-00663434)",
    loanAmount: Currency.of(25000),
    originationFee: Currency.of(0),
    annualInterestRate: new Decimal(0.1105),
    term: 36,
    defaultPreBillDaysConfiguration: 3,
    defaultBillDueDaysAfterPeriodEndConfiguration: 0,
    startDate: DateUtil.normalizeDate("2024-02-05"),
    payoffDate: DateUtil.normalizeDate("2024-06-06"),
    hasCustomEndDate: false,
    hasCustomFirstPaymentDate: false,
    equitedMonthlyPayment: 819.06,
    // hasCustomEquitedMonthlyPayment: true,
    flushUnbilledInterestRoundingErrorMethod: "none",
    roundingPrecision: 2,
    flushThreshold: Currency.of(0.01),

    allowRateAbove100: false,
    termPeriodDefinition: {
      unit: "month",
      count: [1],
    },
    changePaymentDates: new ChangePaymentDates([
      new ChangePaymentDate({
        termNumber: 1,
        newDate: "2024-04-01",
        originalDate: "2024-04-05",
        originalEndDate: "2024-04-05",
        active: true,
      }),
    ]),
    perDiemCalculationType: "AnnualRateDividedByDaysInYear",
    billingModel: "amortized",

    calendars: new TermCalendars({
      primary: new Calendar(CalendarType.THIRTY_360_US),
    }),
    acceptableRateVariance: 0.02,
    accrueInterestAfterEndDate: false,
    interestAccruesFromDayZero: false,
  };

  const lendPeak = new LendPeak({
    amortization: new Amortization(params),

    depositRecords: new DepositRecords([
      new DepositRecord({
        id: "LPT-007792967",
        amount: 6810.53,
        currency: "USD",
        createdDate: DateUtil.normalizeDate("2025-05-05"),
        effectiveDate: DateUtil.normalizeDate("2024-06-06"),
        clearingDate: DateUtil.normalizeDate("2024-06-06"),
        systemDate: DateUtil.normalizeDateTime("2024-06-05"),
        paymentMethod: "Regular",
        depositor: "RTRID-0007792968",
        depositLocation: undefined,
        applyExcessToPrincipal: true,
        excessAppliedDate: DateUtil.normalizeDate("2024-06-06"),
        unusedAmount: 6810.53,
        metadata: undefined,
        active: true,
        staticAllocation: undefined,
        applyExcessAtTheEndOfThePeriod: true,
        refunds: [],
      }),
      new DepositRecord({
        id: "LPT-007789973",
        amount: 76.66,
        currency: "USD",
        createdDate: DateUtil.normalizeDate("2025-05-05"),
        effectiveDate: DateUtil.normalizeDate("2024-06-05"),
        clearingDate: DateUtil.normalizeDate("2024-06-05"),
        systemDate: DateUtil.normalizeDateTime("2024-06-04"),
        paymentMethod: "Regular",
        depositor: "RTRID-0007789974",
        depositLocation: undefined,
        applyExcessToPrincipal: true,
        excessAppliedDate: DateUtil.normalizeDate("2024-06-05"),
        unusedAmount: 76.66,
        metadata: undefined,
        active: true,
        staticAllocation: undefined,
        applyExcessAtTheEndOfThePeriod: true,
        refunds: [],
      }),
      new DepositRecord({
        id: "LPT-007778507",
        amount: 819.06,
        currency: "USD",
        createdDate: DateUtil.normalizeDate("2025-05-05"),
        effectiveDate: DateUtil.normalizeDate("2024-06-03"),
        clearingDate: DateUtil.normalizeDate("2024-06-03"),
        systemDate: DateUtil.normalizeDateTime("2024-05-31"),
        paymentMethod: "Regular",
        depositor: "RTRID-0007778508",
        depositLocation: undefined,
        applyExcessToPrincipal: true,
        excessAppliedDate: DateUtil.normalizeDate("2024-06-03"),
        unusedAmount: 819.06,
        metadata: undefined,
        active: true,
        staticAllocation: undefined,
        applyExcessAtTheEndOfThePeriod: true,
        refunds: [],
      }),
      new DepositRecord({
        id: "LPT-007769389",
        amount: 181,
        currency: "USD",
        createdDate: DateUtil.normalizeDate("2025-05-05"),
        effectiveDate: DateUtil.normalizeDate("2024-05-31"),
        clearingDate: DateUtil.normalizeDate("2024-05-31"),
        systemDate: DateUtil.normalizeDateTime("2024-05-30"),
        paymentMethod: "Regular",
        depositor: "RTRID-0007769390",
        depositLocation: undefined,
        applyExcessToPrincipal: true,
        excessAppliedDate: DateUtil.normalizeDate("2024-05-31"),
        unusedAmount: 181,
        metadata: undefined,
        active: true,
        staticAllocation: undefined,
        applyExcessAtTheEndOfThePeriod: true,
        refunds: [],
      }),
      new DepositRecord({
        id: "LPT-007765525",
        amount: 300,
        currency: "USD",
        createdDate: DateUtil.normalizeDate("2025-05-05"),
        effectiveDate: DateUtil.normalizeDate("2024-05-28"),
        clearingDate: DateUtil.normalizeDate("2024-05-28"),
        systemDate: DateUtil.normalizeDateTime("2024-05-24"),
        paymentMethod: "Regular",
        depositor: "RTRID-0007765526",
        depositLocation: undefined,
        applyExcessToPrincipal: true,
        excessAppliedDate: DateUtil.normalizeDate("2024-05-28"),
        unusedAmount: 300,
        metadata: undefined,
        active: true,
        staticAllocation: undefined,
        applyExcessAtTheEndOfThePeriod: true,
        refunds: [],
      }),
      new DepositRecord({
        id: "LPT-007752333",
        amount: 14635.65,
        currency: "USD",
        createdDate: DateUtil.normalizeDate("2025-05-05"),
        effectiveDate: DateUtil.normalizeDate("2024-05-24"),
        clearingDate: DateUtil.normalizeDate("2024-05-24"),
        systemDate: DateUtil.normalizeDateTime("2024-05-23"),
        paymentMethod: "Regular",
        depositor: "RTRID-0007752334",
        depositLocation: undefined,
        applyExcessToPrincipal: true,
        excessAppliedDate: DateUtil.normalizeDate("2024-05-24"),
        unusedAmount: 6935.65,
        metadata: undefined,
        active: true,
        staticAllocation: undefined,
        applyExcessAtTheEndOfThePeriod: true,
        refunds: [],
      }),
      new DepositRecord({
        id: "LPT-007668174",
        amount: 819.06,
        currency: "USD",
        createdDate: DateUtil.normalizeDate("2025-05-05"),
        effectiveDate: DateUtil.normalizeDate("2024-05-01"),
        clearingDate: DateUtil.normalizeDate("2024-05-01"),
        systemDate: DateUtil.normalizeDateTime("2024-04-30"),
        paymentMethod: "Regular",
        depositor: "RTRID-0007668175",
        depositLocation: undefined,
        applyExcessToPrincipal: true,
        excessAppliedDate: DateUtil.normalizeDate("2024-05-01"),
        unusedAmount: 0,
        metadata: undefined,
        active: true,
        staticAllocation: undefined,
        applyExcessAtTheEndOfThePeriod: true,
        refunds: [],
      }),
      new DepositRecord({
        id: "LPT-007670161",
        amount: 181,
        currency: "USD",
        createdDate: DateUtil.normalizeDate("2025-05-05"),
        effectiveDate: DateUtil.normalizeDate("2024-05-01"),
        clearingDate: DateUtil.normalizeDate("2024-05-01"),
        systemDate: DateUtil.normalizeDateTime("2024-04-30"),
        paymentMethod: "Regular",
        depositor: "RTRID-0007670162",
        depositLocation: undefined,
        applyExcessToPrincipal: true,
        excessAppliedDate: DateUtil.normalizeDate("2024-05-01"),
        unusedAmount: 0,
        metadata: undefined,
        active: true,
        staticAllocation: undefined,
        applyExcessAtTheEndOfThePeriod: true,
        refunds: [],
      }),
      new DepositRecord({
        id: "LPT-007563080",
        amount: 184.24,
        currency: "USD",
        createdDate: DateUtil.normalizeDate("2025-05-05"),
        effectiveDate: DateUtil.normalizeDate("2024-04-02"),
        clearingDate: DateUtil.normalizeDate("2024-04-02"),
        systemDate: DateUtil.normalizeDateTime("2024-04-01"),
        paymentMethod: "Regular",
        depositor: "RTRID-0007563081",
        depositLocation: undefined,
        applyExcessToPrincipal: true,
        excessAppliedDate: DateUtil.normalizeDate("2024-04-02"),
        unusedAmount: 0,
        metadata: undefined,
        active: true,
        staticAllocation: undefined,
        applyExcessAtTheEndOfThePeriod: true,
        refunds: [],
      }),
      new DepositRecord({
        id: "LPT-007556170",
        amount: 819.06,
        currency: "USD",
        createdDate: DateUtil.normalizeDate("2025-05-05"),
        effectiveDate: DateUtil.normalizeDate("2024-04-01"),
        clearingDate: DateUtil.normalizeDate("2024-04-01"),
        systemDate: DateUtil.normalizeDateTime("2024-03-29"),
        paymentMethod: "Regular",
        depositor: "RTRID-0007556171",
        depositLocation: undefined,
        applyExcessToPrincipal: true,
        excessAppliedDate: DateUtil.normalizeDate("2024-04-01"),
        unusedAmount: 0,
        metadata: undefined,
        active: true,
        staticAllocation: undefined,
        applyExcessAtTheEndOfThePeriod: true,
        refunds: [],
      }),
      new DepositRecord({
        id: "LPT-007454081",
        amount: 819.06,
        currency: "USD",
        createdDate: DateUtil.normalizeDate("2025-05-05"),
        effectiveDate: DateUtil.normalizeDate("2024-03-05"),
        clearingDate: DateUtil.normalizeDate("2024-03-05"),
        systemDate: DateUtil.normalizeDateTime("2024-03-04"),
        paymentMethod: "Regular",
        depositor: "RTRID-0007454082",
        depositLocation: undefined,
        applyExcessToPrincipal: true,
        excessAppliedDate: DateUtil.normalizeDate("2024-03-05"),
        unusedAmount: 0,
        metadata: undefined,
        active: true,
        staticAllocation: undefined,
        applyExcessAtTheEndOfThePeriod: true,
        refunds: [],
      }),
      new DepositRecord({
        id: "LPT-007438586",
        amount: 181,
        currency: "USD",
        createdDate: DateUtil.normalizeDate("2025-05-05"),
        effectiveDate: DateUtil.normalizeDate("2024-03-01"),
        clearingDate: DateUtil.normalizeDate("2024-03-01"),
        systemDate: DateUtil.normalizeDateTime("2024-02-29"),
        paymentMethod: "Regular",
        depositor: "RTRID-0007438587",
        depositLocation: undefined,
        applyExcessToPrincipal: true,
        excessAppliedDate: DateUtil.normalizeDate("2024-03-01"),
        unusedAmount: 0,
        metadata: undefined,
        active: true,
        staticAllocation: undefined,
        applyExcessAtTheEndOfThePeriod: true,
        refunds: [],
      }),
    ]),
    currentDate: DateUtil.normalizeDate("2025-01-01"),
  });

  // Force generation of schedule/bills, etc.
  lendPeak.calc();

  // it("unusedAmountFromDeposis must be zero", () => {
  //   expect(lendPeak.payoffQuote.unusedAmountFromDeposis.toNumber()).toEqual(405.66);
  // });

  // it("payoff amount must be zero", () => {
  //   expect(lendPeak.payoffQuote.dueTotal.toNumber()).toEqual(0);
  // });

  // it("verify balance modification to be set to zero", () => {
  //   expect(lendPeak.amortization.balanceModifications.length).toEqual(0);
  // });

  it("verify bills", () => {
    expect(lendPeak.bills.length).toBe(5);
  });
});
